<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>TMS Coil Orientation Survey</title>
  <style>
    body { margin: 0; background: #f2f2f2; }
    #viewer { width: 100vw; height: 75vh; }
    #slider-container { text-align: center; margin: 12px 0; }
    #angle-value { font-weight: bold; }
  </style>
</head>
<body>
  <div id="viewer"></div>
  <div id="slider-container">
    <label for="coil-angle">Coil orientation (degrees): </label>
    <input id="coil-angle" type="range" min="-180" max="180" value="0" />
    <span id="angle-value">0</span>
  </div>

  <!-- Correct script includes from CDN -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.153.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.153.0/examples/js/loaders/STLLoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.153.0/examples/js/controls/OrbitControls.js"></script>

  <script>
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(60, window.innerWidth/(0.75*window.innerHeight), 0.1, 1000);
    camera.position.set(0, 0, 250);

    const renderer = new THREE.WebGLRenderer({ antialias:true });
    renderer.setSize(window.innerWidth, window.innerHeight*0.75);
    document.getElementById('viewer').appendChild(renderer.domElement);

    const controls = new THREE.OrbitControls(camera, renderer.domElement);

    // Lighting
    scene.add(new THREE.AmbientLight(0xffffff, 0.7));
    const dirLight = new THREE.DirectionalLight(0xffffff, 0.7);
    dirLight.position.set(0, 100, 200);
    scene.add(dirLight);

    // Load STL files
    const loader = new THREE.STLLoader();
    let coil;

    loader.load('head.stl', geometry => {
      const material = new THREE.MeshPhongMaterial({ color: 0x888888, opacity: 0.85, transparent: true });
      const head = new THREE.Mesh(geometry, material);
      scene.add(head);
      geometry.computeBoundingBox();
      controls.target.copy(geometry.boundingBox.getCenter(new THREE.Vector3()));
      camera.position.z = geometry.boundingBox.max.z + 150;
    });

    loader.load('coil.stl', geometry => {
      coil = new THREE.Mesh(geometry, new THREE.MeshPhongMaterial({ color: 0x0033ff }));
      scene.add(coil);
    });

    // Slider to control coil rotation
    const slider = document.getElementById('coil-angle');
    const value = document.getElementById('angle-value');
    slider.oninput = () => {
      value.textContent = slider.value;
      if (coil) coil.rotation.z = THREE.MathUtils.degToRad(slider.value);
    };

    // Animation loop
    function animate() {
      controls.update();
      renderer.render(scene, camera);
      requestAnimationFrame(animate);
    }
    animate();
  </script>
</body>
</html>
